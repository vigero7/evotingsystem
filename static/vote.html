<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Digital Voting Booth | E-Voting System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%);
            min-height: 100vh;
        }
        .glass {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .security-border {
            background: linear-gradient(90deg, #10b981, #3b82f6, #8b5cf6, #10b981);
            background-size: 400% 400%;
            animation: gradient 3s ease infinite;
        }
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .candidate-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 3px solid transparent;
        }
        .candidate-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.15);
        }
        .candidate-card.selected {
            border-color: #10b981;
            transform: scale(1.02);
            box-shadow: 0 25px 50px -12px rgba(16, 185, 129, 0.4);
            background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%);
        }
        .pulse-glow {
            animation: pulse-glow 2s ease-in-out infinite alternate;
        }
        @keyframes pulse-glow {
            from { box-shadow: 0 0 20px rgba(16, 185, 129, 0.5); }
            to { box-shadow: 0 0 30px rgba(16, 185, 129, 0.8); }
        }
        .encryption-animation {
            background: linear-gradient(90deg, #f0f9ff, #e0f2fe, #f0f9ff);
            background-size: 200% 100%;
            animation: encryption 2s ease-in-out infinite;
        }
        @keyframes encryption {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        .countdown-timer {
            font-family: 'Courier New', monospace;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
    </style>
</head>
<body class="antialiased">
    <!-- Security Header -->
    <div class="security-border py-2 text-center">
        <div class="container mx-auto">
            <div class="flex items-center justify-center space-x-4 text-white text-sm font-semibold">
                <div class="flex items-center">
                    <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/>
                    </svg>
                    SECURE SESSION
                </div>
                <div class="flex items-center">
                    <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                    </svg>
                    ENCRYPTED CONNECTION
                </div>
                <div class="flex items-center">
                    <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
                        <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
                    </svg>
                    OFFICIAL BALLOT
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="glass shadow-2xl sticky top-0 z-50">
        <div class="container mx-auto max-w-7xl px-6 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-4">
                <div class="w-12 h-12 bg-gradient-to-br from-blue-600 to-purple-600 rounded-xl flex items-center justify-center shadow-lg">
                    <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                </div>
                <div>
                    <h1 class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent" id="electionHeader">Digital Voting Booth</h1>
                    <p class="text-sm text-gray-600">Secure • Anonymous • Verifiable</p>
                </div>
            </div>
            <div class="flex space-x-3">
                <a href="/results" class="px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105 flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                    </svg>
                    Live Results
                </a>
                <a href="/admin" class="px-6 py-3 bg-gradient-to-r from-gray-700 to-gray-900 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105 flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                    </svg>
                    Admin Portal
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto max-w-6xl px-6 py-8">
        <!-- Confirmation Modal -->
        <div id="confirmationModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70 hidden">
            <div class="glass rounded-3xl shadow-2xl p-8 max-w-md w-full mx-4 transform transition-all border-4 border-green-200">
                <div class="text-center">
                    <div class="mx-auto flex items-center justify-center h-20 w-20 rounded-full bg-gradient-to-br from-green-500 to-emerald-500 mb-4 pulse-glow">
                        <svg class="h-10 w-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                        </svg>
                    </div>
                    <h2 class="text-3xl font-bold text-gray-900 mb-3">Confirm Your Vote</h2>
                    <p class="text-gray-600 mb-2">You are about to cast your vote for:</p>
                    <div class="bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl p-4 mb-6">
                        <p id="modalCandidateName" class="text-2xl font-bold text-green-700"></p>
                        <p id="modalCandidateParty" class="text-sm text-green-600 mt-1"></p>
                    </div>
                    <p class="text-sm text-gray-500 mb-6">This action is final and cannot be changed. Your vote will be encrypted and anonymized.</p>
                    <div class="flex justify-center space-x-4">
                        <button id="cancelVoteBtn" class="px-8 py-4 bg-gray-200 text-gray-700 font-bold rounded-xl hover:bg-gray-300 transition-all border-2 border-gray-300">
                            Review Again
                        </button>
                        <button id="confirmVoteBtn" class="px-8 py-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold rounded-xl hover:shadow-2xl transition-all hover:scale-105 border-2 border-green-500 shadow-lg">
                            <span class="flex items-center">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                </svg>
                                Confirm & Cast Vote
                            </span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Voting Area -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left: Registration & Voting Steps -->
            <div class="lg:col-span-2 space-y-8">
                <!-- Registration Step -->
                <div id="registrationStep" class="glass rounded-3xl shadow-2xl p-8 border-4 border-blue-200">
                    <div class="text-center mb-8">
                        <div class="inline-flex items-center justify-center p-4 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl mb-4">
                            <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                            </svg>
                        </div>
                        <h2 class="text-3xl font-bold text-gray-800 mb-3" id="registrationTitle">Voter Identity Verification</h2>
                        <p class="text-gray-600">Please verify your identity to access the secure voting system</p>
                    </div>
                    <div class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="voterName" class="block text-sm font-semibold text-gray-700 mb-3 flex items-center">
                                    <svg class="w-4 h-4 mr-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                    </svg>
                                    Full Legal Name
                                </label>
                                <input type="text" id="voterName" placeholder="Enter your full name as registered" class="w-full px-5 py-4 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-200 outline-none transition-all text-lg">
                            </div>
                            <div>
                                <label for="voterId" class="block text-sm font-semibold text-gray-700 mb-3 flex items-center">
                                    <svg class="w-4 h-4 mr-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 114 0v1m-4 0a2 2 0 104 0m-5 8a2 2 0 100-4 2 2 0 000 4zm0 0c1.306 0 2.417.835 2.83 2M9 14a3.001 3.001 0 00-2.83 2M15 11h3m-3 4h2"/>
                                    </svg>
                                    Voter ID Number
                                </label>
                                <input type="text" id="voterId" placeholder="VOT202400001" class="w-full px-5 py-4 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-200 outline-none transition-all text-lg font-mono">
                            </div>
                        </div>
                        <div class="bg-blue-50 border-2 border-blue-200 rounded-xl p-4">
                            <div class="flex items-start">
                                <svg class="w-5 h-5 text-blue-500 mr-3 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                <p class="text-sm text-blue-700">Your information is used only for identity verification and will not be linked to your encrypted vote. All votes are anonymous and secure.</p>
                            </div>
                        </div>
                        <button id="registerButton" class="w-full py-5 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold text-xl rounded-xl shadow-2xl hover:shadow-3xl transition-all hover:scale-105 pulse-glow">
                            <span class="flex items-center justify-center">
                                <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                                </svg>
                                Verify Identity & Continue
                            </span>
                        </button>
                    </div>
                </div>

                <!-- Voting Step -->
                <div id="votingStep" class="hidden">
                    <div class="glass rounded-3xl shadow-2xl p-8 border-4 border-green-200">
                        <div class="text-center mb-8">
                            <div class="inline-flex items-center justify-center p-4 bg-gradient-to-br from-green-500 to-emerald-600 rounded-2xl mb-4">
                                <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                                </svg>
                            </div>
                            <h2 class="text-3xl font-bold text-gray-800 mb-2" id="ballotTitle">Official Ballot</h2>
                            <p class="text-gray-600">Welcome, <span id="displayName" class="font-bold text-green-600"></span>! Please select your candidate.</p>
                        </div>
                        
                        <div class="mb-8">
                            <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                                <svg class="w-6 h-6 mr-2 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                                <span id="electionTypeDisplay">Presidential Election 2024</span>
                            </h3>
                            <div id="candidateOptions" class="grid grid-cols-1 gap-4"></div>
                        </div>

                        <button id="castVoteButton" class="w-full py-5 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold text-xl rounded-xl shadow-2xl hover:shadow-3xl transition-all hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 disabled:hover:shadow-2xl border-2 border-green-500">
                            <span class="flex items-center justify-center">
                                <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                                </svg>
                                Cast Secure Vote
                            </span>
                        </button>
                    </div>
                </div>

                <!-- Receipt Step -->
                <div id="receiptStep" class="hidden">
                    <div class="glass rounded-3xl shadow-2xl p-8 border-4 border-emerald-200 text-center">
                        <div class="inline-flex items-center justify-center p-4 bg-gradient-to-br from-emerald-500 to-green-600 rounded-2xl mb-6">
                            <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </div>
                        <h2 class="text-4xl font-bold text-emerald-600 mb-4">Vote Successfully Cast!</h2>
                        <p class="text-gray-600 text-lg mb-6">Your vote has been encrypted, digitally signed, and securely recorded in the blockchain.</p>
                        
                        <div class="bg-gradient-to-br from-emerald-50 to-green-50 border-4 border-emerald-200 p-8 rounded-2xl mb-8">
                            <p class="text-xs text-emerald-600 uppercase tracking-widest font-semibold mb-4">Your Anonymous Voting Receipt</p>
                            <div id="receiptCode" class="text-3xl font-bold font-mono text-emerald-700 break-all p-4 bg-white rounded-xl shadow-inner"></div>
                            <p class="text-sm text-emerald-600 mt-4">Save this receipt for verification purposes</p>
                        </div>
                        
                        <div class="encryption-animation rounded-xl p-6 mb-8">
                            <div class="flex items-center justify-center space-x-4 text-gray-700">
                                <svg class="w-8 h-8 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                                </svg>
                                <span class="text-lg font-semibold">Vote Encrypted & Secured</span>
                                <svg class="w-8 h-8 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                                </svg>
                            </div>
                        </div>

                        <button id="nextVoterBtn" class="w-full py-5 bg-gradient-to-r from-gray-700 to-gray-900 text-white font-bold text-xl rounded-xl shadow-2xl hover:shadow-3xl transition-all hover:scale-105">
                            <span class="flex items-center justify-center">
                                <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                                </svg>
                                Next Voter
                            </span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Right: Information Panel -->
            <div class="space-y-8">
                <!-- Election Info -->
                <div class="glass rounded-3xl shadow-2xl p-6 border-4 border-purple-200">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <svg class="w-6 h-6 mr-2 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        Election Information
                    </h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between p-3 bg-purple-50 rounded-lg">
                            <span class="text-sm font-semibold text-purple-700">Election Type:</span>
                            <span class="text-sm text-purple-900" id="infoElectionType">Presidential</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-blue-50 rounded-lg">
                            <span class="text-sm font-semibold text-blue-700">Election Date:</span>
                            <span class="text-sm text-blue-900" id="infoElectionDate">November 5, 2024</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                            <span class="text-sm font-semibold text-green-700">Voting Status:</span>
                            <span id="infoVotingStatus" class="text-sm font-bold text-green-600">Open</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-orange-50 rounded-lg">
                            <span class="text-sm font-semibold text-orange-700">Voting Hours:</span>
                            <span class="text-sm text-orange-900" id="infoVotingHours">07:00 - 19:00</span>
                        </div>
                    </div>
                </div>

                <!-- Countdown Timer -->
                <div class="glass rounded-3xl shadow-2xl p-6 border-4 border-red-200">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <svg class="w-6 h-6 mr-2 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        Voting Countdown
                    </h3>
                    <div class="text-center">
                        <div id="countdownTimer" class="text-3xl font-bold countdown-timer mb-2">--:--:--</div>
                        <p class="text-sm text-gray-600" id="countdownLabel">Time remaining to vote</p>
                    </div>
                </div>

                <!-- Security Features -->
                <div class="glass rounded-3xl shadow-2xl p-6 border-4 border-blue-200">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <svg class="w-6 h-6 mr-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                        </svg>
                        Security Features
                    </h3>
                    <div class="space-y-3">
                        <div class="flex items-center p-3 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200">
                            <svg class="w-5 h-5 text-blue-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                            </svg>
                            <span class="text-sm font-semibold text-blue-700">End-to-End Encryption</span>
                        </div>
                        <div class="flex items-center p-3 bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg border border-green-200">
                            <svg class="w-5 h-5 text-green-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                            </svg>
                            <span class="text-sm font-semibold text-green-700">Digital Signature Verification</span>
                        </div>
                        <div class="flex items-center p-3 bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg border border-purple-200">
                            <svg class="w-5 h-5 text-purple-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
                            </svg>
                            <span class="text-sm font-semibold text-purple-700">Anonymous Ballot System</span>
                        </div>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="glass rounded-3xl shadow-2xl p-6 border-4 border-green-200">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <svg class="w-6 h-6 mr-2 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                        </svg>
                        Voting Statistics
                    </h3>
                    <div class="space-y-4">
                        <div class="text-center p-4 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl">
                            <div class="text-2xl font-bold text-blue-600" id="totalVotes">0</div>
                            <div class="text-sm text-blue-700">Total Votes Cast</div>
                        </div>
                        <div class="text-center p-4 bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl">
                            <div class="text-2xl font-bold text-green-600" id="registeredVoters">0</div>
                            <div class="text-sm text-green-700">Registered Voters</div>
                        </div>
                        <div class="text-center p-4 bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl">
                            <div class="text-2xl font-bold text-purple-600" id="candidatesCount">0</div>
                            <div class="text-sm text-purple-700">Candidates</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white mt-16">
        <div class="container mx-auto max-w-7xl px-6 py-8">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="flex items-center space-x-3 mb-4 md:mb-0">
                    <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-500 rounded-lg flex items-center justify-center">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>
                    <span class="text-lg font-semibold" id="footerTitle">Secure E-Voting System</span>
                </div>
                <div class="text-sm text-gray-400">
                    © 2024 National Election Commission. All rights reserved.
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Use relative URL to work with any host
        const API_URL = window.location.origin;
        
        let voterCredentials = {};
        let eaCryptoKey = null;
        let electionConfig = null;
        let countdownInterval = null;
        
        const registrationStep = document.getElementById('registrationStep');
        const votingStep = document.getElementById('votingStep');
        const receiptStep = document.getElementById('receiptStep');
        const receiptCode = document.getElementById('receiptCode');
        const nextVoterBtn = document.getElementById('nextVoterBtn');
        const registerButton = document.getElementById('registerButton');
        const castVoteButton = document.getElementById('castVoteButton');
        const voterNameInput = document.getElementById('voterName');
        const voterIdInput = document.getElementById('voterId');
        const candidateOptions = document.getElementById('candidateOptions');
        const displayName = document.getElementById('displayName');
        const modal = document.getElementById('confirmationModal');
        const modalCandidateName = document.getElementById('modalCandidateName');
        const modalCandidateParty = document.getElementById('modalCandidateParty');
        const confirmVoteBtn = document.getElementById('confirmVoteBtn');
        const cancelVoteBtn = document.getElementById('cancelVoteBtn');
        const totalVotesElement = document.getElementById('totalVotes');
        const registeredVotersElement = document.getElementById('registeredVoters');
        const candidatesCountElement = document.getElementById('candidatesCount');
        const votingStatusElement = document.getElementById('infoVotingStatus');
        
        // Election info elements
        const electionHeader = document.getElementById('electionHeader');
        const registrationTitle = document.getElementById('registrationTitle');
        const ballotTitle = document.getElementById('ballotTitle');
        const electionTypeDisplay = document.getElementById('electionTypeDisplay');
        const infoElectionType = document.getElementById('infoElectionType');
        const infoElectionDate = document.getElementById('infoElectionDate');
        const infoVotingHours = document.getElementById('infoVotingHours');
        const footerTitle = document.getElementById('footerTitle');
        const countdownTimer = document.getElementById('countdownTimer');
        const countdownLabel = document.getElementById('countdownLabel');
        
        function arrayBufferToBase64(buffer) { 
            const bytes = new Uint8Array(buffer);
            let binary = '';
            for (let i = 0; i < bytes.byteLength; i++) {
                binary += String.fromCharCode(bytes[i]);
            }
            return btoa(binary);
        }

        function base64ToArrayBuffer(base64) {
            const binaryString = atob(base64);
            const bytes = new Uint8Array(binaryString.length);
            for (let i = 0; i < binaryString.length; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            return bytes.buffer;
        }

        function loadElectionConfiguration() {
            const savedConfig = localStorage.getItem('electionConfig');
            if (savedConfig) {
                electionConfig = JSON.parse(savedConfig);
                applyElectionConfiguration();
            } else {
                // Use default configuration
                electionConfig = {
                    title: "Presidential Election 2024",
                    type: "presidential",
                    date: "2024-11-05",
                    votingStart: "07:00",
                    votingEnd: "19:00",
                    maxVotes: 1,
                    allowWriteIns: false,
                    candidates: [
                        { 
                            id: 1,
                            name: "Sarah Chen", 
                            party: "Progressive Alliance", 
                            color: "from-blue-500 to-indigo-600",
                            experience: "Former Governor, 8 years executive experience",
                            slogan: "Building Tomorrow, Together"
                        },
                        { 
                            id: 2,
                            name: "Marcus Rodriguez", 
                            party: "Unity Coalition", 
                            color: "from-green-500 to-emerald-600",
                            experience: "Senator, 12 years legislative experience", 
                            slogan: "Strength Through Unity"
                        },
                        { 
                            id: 3,
                            name: "Dr. Amelia Watson", 
                            party: "Innovation Party", 
                            color: "from-purple-500 to-pink-600",
                            experience: "Technology Entrepreneur & Educator",
                            slogan: "Future-Ready Leadership"
                        }
                    ]
                };
                applyElectionConfiguration();
            }
        }

        function applyElectionConfiguration() {
            if (!electionConfig) return;

            // Update page titles and headers
            electionHeader.textContent = electionConfig.title;
            registrationTitle.textContent = `Voter Identity Verification - ${electionConfig.title}`;
            ballotTitle.textContent = `Official Ballot - ${electionConfig.title}`;
            electionTypeDisplay.textContent = `${formatElectionType(electionConfig.type)} ${new Date(electionConfig.date).getFullYear()}`;
            footerTitle.textContent = electionConfig.title;

            // Update election information panel
            infoElectionType.textContent = formatElectionType(electionConfig.type);
            infoElectionDate.textContent = formatDate(electionConfig.date);
            infoVotingHours.textContent = `${electionConfig.votingStart} - ${electionConfig.votingEnd}`;

            // Update candidate count
            candidatesCountElement.textContent = electionConfig.candidates ? electionConfig.candidates.length : 0;

            // Start countdown timer
            startCountdownTimer();

            // Refresh page every 30 seconds to get updated configuration
            setTimeout(loadElectionConfiguration, 30000);
        }

        function formatElectionType(type) {
            const types = {
                'presidential': 'Presidential Election',
                'parliamentary': 'Parliamentary Election',
                'local': 'Local Government Election',
                'referendum': 'National Referendum',
                'primary': 'Primary Election'
            };
            return types[type] || type;
        }

        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return new Date(dateString).toLocaleDateString('en-US', options);
        }

        function startCountdownTimer() {
            if (countdownInterval) {
                clearInterval(countdownInterval);
            }

            const electionDate = new Date(electionConfig.date);
            const now = new Date();
            
            // Set voting hours
            const [startHour, startMinute] = electionConfig.votingStart.split(':').map(Number);
            const [endHour, endMinute] = electionConfig.votingEnd.split(':').map(Number);
            
            const votingStart = new Date(electionDate);
            votingStart.setHours(startHour, startMinute, 0, 0);
            
            const votingEnd = new Date(electionDate);
            votingEnd.setHours(endHour, endMinute, 0, 0);

            function updateCountdown() {
                const now = new Date();
                
                if (now < votingStart) {
                    // Voting hasn't started yet
                    const diff = votingStart - now;
                    countdownTimer.textContent = formatTime(diff);
                    countdownLabel.textContent = "Until voting starts";
                    countdownTimer.className = "text-3xl font-bold countdown-timer mb-2";
                } else if (now >= votingStart && now <= votingEnd) {
                    // Voting is in progress
                    const diff = votingEnd - now;
                    countdownTimer.textContent = formatTime(diff);
                    countdownLabel.textContent = "Time remaining to vote";
                    
                    // Change color based on remaining time
                    const hoursLeft = diff / (1000 * 60 * 60);
                    if (hoursLeft < 1) {
                        countdownTimer.className = "text-3xl font-bold text-red-600 mb-2";
                    } else if (hoursLeft < 3) {
                        countdownTimer.className = "text-3xl font-bold text-orange-600 mb-2";
                    } else {
                        countdownTimer.className = "text-3xl font-bold text-green-600 mb-2";
                    }
                } else {
                    // Voting has ended
                    countdownTimer.textContent = "00:00:00";
                    countdownLabel.textContent = "Voting has ended";
                    countdownTimer.className = "text-3xl font-bold text-red-600 mb-2";
                }
            }

            updateCountdown();
            countdownInterval = setInterval(updateCountdown, 1000);
        }

        function formatTime(milliseconds) {
            const totalSeconds = Math.floor(milliseconds / 1000);
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        async function importPublicKey(pem) {
            try {
                const pemHeader = "-----BEGIN PUBLIC KEY-----";
                const pemFooter = "-----END PUBLIC KEY-----";
                
                let pemContents = pem.replace(pemHeader, '').replace(pemFooter, '').replace(/\s+/g, '');
                
                const binaryDer = base64ToArrayBuffer(pemContents);
                
                return await window.crypto.subtle.importKey(
                    "spki", 
                    binaryDer, 
                    { 
                        name: "RSA-OAEP", 
                        hash: "SHA-256" 
                    }, 
                    true, 
                    ["encrypt"]
                );
            } catch (error) {
                throw new Error(`Failed to import public key: ${error.message}`);
            }
        }

        async function updateElectionStats() {
            try {
                const response = await fetch(`${API_URL}/election/status`);
                if (response.ok) {
                    const data = await response.json();
                    totalVotesElement.textContent = data.total_votes_cast;
                    registeredVotersElement.textContent = data.total_registered;
                    votingStatusElement.textContent = data.election_state === 'VOTING_OPEN' ? 'OPEN' : 'CLOSED';
                    votingStatusElement.className = data.election_state === 'VOTING_OPEN' ? 
                        'text-sm font-bold text-green-600' : 'text-sm font-bold text-red-600';
                }
            } catch (error) {
                console.error('Failed to fetch election stats:', error);
            }
        }

        function resetForNextVoter() {
            voterCredentials = {};
            voterNameInput.value = '';
            voterIdInput.value = '';
            receiptStep.classList.add('hidden');
            registrationStep.classList.remove('hidden');
            registerButton.disabled = false;
            registerButton.textContent = "Verify Identity & Continue";
            updateElectionStats();
        }

        function openConfirmationModal() {
            const selectedCandidate = document.querySelector('.candidate-card.selected');
            if (!selectedCandidate) { 
                alert("Please select a candidate before casting your vote.");
                return; 
            }
            
            const candidateName = selectedCandidate.dataset.candidate;
            const candidateParty = selectedCandidate.dataset.party;
            
            modalCandidateName.textContent = candidateName;
            modalCandidateParty.textContent = candidateParty;
            modal.classList.remove('hidden');
        }

        async function executeVote() {
            modal.classList.add('hidden');
            const selectedCandidate = modalCandidateName.textContent;
            castVoteButton.disabled = true;
            castVoteButton.textContent = "🔒 Encrypting & Submitting Vote...";
            
            try {
                const voteText = new TextEncoder().encode(`VOTE FOR ${selectedCandidate}`);
                
                const encryptedVoteBuffer = await window.crypto.subtle.encrypt(
                    { name: "RSA-OAEP" }, 
                    eaCryptoKey, 
                    voteText
                );
                
                const signatureBuffer = await window.crypto.subtle.sign(
                    { 
                        name: "RSA-PSS",
                        saltLength: 32 
                    }, 
                    voterCredentials.keys.privateKey, 
                    encryptedVoteBuffer
                );

                const payload = {
                    voter_id: voterCredentials.id,
                    encrypted_vote_b64: arrayBufferToBase64(encryptedVoteBuffer),
                    signature_b64: arrayBufferToBase64(signatureBuffer)
                };
                
                const response = await fetch(`${API_URL}/vote/cast`, { 
                    method: 'POST', 
                    headers: { 'Content-Type': 'application/json' }, 
                    body: JSON.stringify(payload) 
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'Failed to cast vote');
                }
                
                const result = await response.json();
                receiptCode.textContent = result.receipt;
                votingStep.classList.add('hidden');
                receiptStep.classList.remove('hidden');
                updateElectionStats();
            } catch (error) {
                alert(`Voting failed: ${error.message}`);
                castVoteButton.disabled = false;
                castVoteButton.textContent = "Cast Secure Vote";
            }
        }

        async function registerAndGenerateKeys() {
            const voterName = voterNameInput.value.trim();
            const voterId = voterIdInput.value.trim();
            
            if (!voterName || !voterId) { 
                alert("Please enter both your full name and Voter ID to continue.");
                return; 
            }
            
            registerButton.disabled = true; 
            registerButton.textContent = "⏳ Verifying Identity...";
            
            try {
                const keyResponse = await fetch(`${API_URL}/election/key`);
                
                if (!keyResponse.ok) {
                    throw new Error('Failed to connect to election server. Please try again.');
                }
                
                const keyData = await keyResponse.json();
                eaCryptoKey = await importPublicKey(keyData.ea_public_key_pem);
                
                const keyPair = await window.crypto.subtle.generateKey(
                    {
                        name: "RSA-PSS",
                        modulusLength: 2048,
                        publicExponent: new Uint8Array([0x01, 0x00, 0x01]),
                        hash: { name: "SHA-256" }
                    },
                    true,
                    ["sign", "verify"]
                );
                
                const publicKeySpki = await window.crypto.subtle.exportKey('spki', keyPair.publicKey);
                const publicKeyBase64 = arrayBufferToBase64(publicKeySpki);
                
                let formattedPem = '';
                for (let i = 0; i < publicKeyBase64.length; i += 64) {
                    formattedPem += publicKeyBase64.substring(i, i + 64) + '\n';
                }
                
                const publicKeyPem = `-----BEGIN PUBLIC KEY-----\n${formattedPem}-----END PUBLIC KEY-----`;
                
                voterCredentials = { name: voterName, id: voterId, keys: keyPair };
                
                const regResponse = await fetch(`${API_URL}/voter/register`, { 
                    method: 'POST', 
                    headers: { 'Content-Type': 'application/json' }, 
                    body: JSON.stringify({ 
                        voter_id: voterId, 
                        public_key_pem: publicKeyPem, 
                        name: voterName 
                    }) 
                });
                
                if (!regResponse.ok) {
                    const error = await regResponse.json();
                    throw new Error(error.detail || 'Registration failed');
                }
                
                displayName.textContent = voterName;
                populateCandidates();
                registrationStep.classList.add('hidden');
                votingStep.classList.remove('hidden');
                updateElectionStats();
            } catch (error) {
                alert(`Registration failed: ${error.message}`);
                registerButton.disabled = false; 
                registerButton.textContent = "Verify Identity & Continue";
            }
        }
        
        function populateCandidates() {
            if (!electionConfig || !electionConfig.candidates) {
                candidateOptions.innerHTML = '<div class="text-center text-gray-500 py-8">No candidates available for this election.</div>';
                return;
            }

            candidateOptions.innerHTML = '';
            electionConfig.candidates.forEach((candidate) => {
                const card = document.createElement('div');
                card.className = `candidate-card cursor-pointer bg-white p-6 rounded-2xl text-left border-4 border-gray-200 shadow-lg hover:border-green-300`;
                card.dataset.candidate = candidate.name;
                card.dataset.party = candidate.party;
                card.innerHTML = `
                    <div class="flex items-start space-x-4">
                        <div class="w-16 h-16 bg-gradient-to-br ${candidate.color} rounded-xl flex items-center justify-center text-white text-2xl font-bold shadow-lg">
                            ${candidate.name.split(' ').map(n => n[0]).join('')}
                        </div>
                        <div class="flex-1">
                            <div class="flex items-center justify-between mb-2">
                                <h4 class="font-bold text-xl text-gray-800">${candidate.name}</h4>
                                <span class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm font-semibold">${candidate.party}</span>
                            </div>
                            <p class="text-sm text-gray-600 mb-2">${candidate.experience}</p>
                            <p class="text-sm font-semibold text-gray-700">"${candidate.slogan}"</p>
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t border-gray-200 flex justify-end">
                        <div class="px-4 py-2 bg-gradient-to-r ${candidate.color} text-white font-semibold rounded-lg text-sm">
                            SELECT CANDIDATE
                        </div>
                    </div>
                `;
                card.addEventListener('click', () => selectCandidate(card));
                candidateOptions.appendChild(card);
            });
        }
        
        function selectCandidate(selectedCard) {
            document.querySelectorAll('.candidate-card').forEach(card => {
                card.classList.remove('selected');
                card.style.borderColor = '#e5e7eb';
            });
            selectedCard.classList.add('selected');
            castVoteButton.disabled = false;
        }
        
        // Event listeners
        registerButton.addEventListener('click', registerAndGenerateKeys);
        castVoteButton.addEventListener('click', openConfirmationModal);
        confirmVoteBtn.addEventListener('click', executeVote);
        cancelVoteBtn.addEventListener('click', () => modal.classList.add('hidden'));
        nextVoterBtn.addEventListener('click', resetForNextVoter);
        
        // Allow Enter key to submit registration
        voterIdInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !registerButton.disabled) {
                registerAndGenerateKeys();
            }
        });
        
        voterNameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !registerButton.disabled) {
                registerAndGenerateKeys();
            }
        });

        // Check Web Crypto API support
        window.addEventListener('load', () => {
            if (!window.crypto || !window.crypto.subtle) {
                alert("This browser doesn't support the required cryptographic functions. Please use a modern browser like Chrome, Firefox, or Edge.");
                registerButton.disabled = true;
            }
            
            // Load election configuration
            loadElectionConfiguration();
            
            updateElectionStats();
            // Update stats every 10 seconds
            setInterval(updateElectionStats, 10000);
        });
    </script>
</body>
</html>